أهلاً بك. بصفتي مطور فرونت إند فلاتر بخبرة تتجاوز العشر سنوات، أؤمن بأن "العقد أقوى حلقاته ضعفاً"، والربط مع الباكند (Backend) هو الحلقة الأكثر حساسية في التطبيق. لضمان بناء التطبيق بشكل متين، قابل للتوسع، وخالي من الأخطاء "الشائعة"، هذه هي قائمة المتطلبات الدقيقة التي أحتاجها من مطور الباكند:

### 1. التوثيق (Documentation) - "الخريطة"
لا يمكن البدء بدون خريطة واضحة. الكود ليس كافياً.
*   **Swagger / OpenAPI أو Postman Collection:** هذه هي الأداة الأهم. يجب أن تكون المجموعة (Collection) محدثة وتعكس الواقع وليس مجرد مسودة.
*   **أمثلة حية (Examples):** لكل Endpoint، أحتاج إلى مثال لـ Request Body و مثال لـ Response Body (نجاح وفشل). هذا يساعدني في بناء نماذج البيانات (Models) بدقة باستخدام أدوات مثل `json_serializable` أو `freezed`.

### 2. المصادقة والتفويض (Authentication & Authorization)
هنا تقع معظم مشاكل المستخدمين:
*   **الآلية:** هل نستخدم JWT (Access & Refresh Tokens)؟ أم OAuth2؟ أم Session Cookies؟
*   **دورة حياة التوكن:** متى ينتهي صلاحية الـ Access Token؟ وكيف يتم تجديده (Refresh)؟ هل الـ Refresh Token يدور (rotates) أم يبقى ثابتاً؟
*   **تخزين التوكن:** هل هناك قيود أمنية معينة؟ (غالباً نستخدم `flutter_secure_storage`، لكن أحتاج لتأكيد الآلية).
*   **تسجيل الخروج (Logout):** هل يقوم الباكند بإلغاء التوكن من السيرفر أم أن الحذف يتم من جانب العميل فقط؟

### 3. هيكلية الاستجابة (Response Structure) - "الاتساق"
أكبر خطأ يقع فيه الباكند هو اختلاف شكل الاستجابة بين Endpoint وآخر. أحتاج إلى "عقد" موحد:
*   **شكل موحد للنجاح (Success Response):**
    ```json
    {
      "status": true,
      "code": 200,
      "message": "تمت العملية بنجاح",
      "data": { ... }
    }
    ```
*   **شكل موحد للخطأ (Error Response):**
    ```json
    {
      "status": false,
      "code": 401,
      "message": "غير مصرح لك بالدخول",
      "errors": { "email": "الإيميل غير صالح" } // لعرض الأخطاء تحت الحقول
    }
    ```
*   لماذا هذا مهم؟ لأنني سأبني `BaseModel` واحد في فلاتر للتعامل مع جميع الطلبات، وأي خروج عن هذا النظام سيسبب "Crash" أو رمز غير نظيف.

### 4. أنواع البيانات والتحقق (Data Types & Validation)
*   **التواريخ (Dates):** بأي صيغة تأتي؟ (ISO 8601 مثل `2023-10-25T14:30:00Z`)؟ الطوابع الزمنية (Timestamps)؟ أحتاج لمعرفة ذلك لتحويلها لكائن `DateTime` في دارت.
*   **القيم الفارغة (Null Safety):** هل الحقل إذا كان فارغاً يأتي كـ `null` أم كـ String فارغ `""`؟ الفرق جوهري في لغة Dart التي تعتمد على Null Safety.
*   **الأرقام:** هل الـ IDs تأتي كـ `Int` أم `String`؟ (مهم جداً لأن Dart `int` يختلف عن JSON `int` في بعض الحالات الكبيرة).
*   **التعدادات (Enums):** كيف يتم إرسالها؟ (Integer index أم String name؟).

### 5. الملفات والوسائط (Media & Files)
*   **الرفع (Upload):** هل نستخدم `multipart/form-data`؟ وهل الرفع يكون دفعة واحدة أم مقطع (Chunked Upload) للملفات الكبيرة؟
*   **الروابط:** هل روابط الصور كاملة (`https://example.com/image.jpg`) أم نسبية (`/uploads/image.jpg`)؟ (لأقوم بمعالجتها داخل الـ Model).
*   **الضغط:** هل يقوم الباكند بضغط الصور تلقائياً أم يجب أن أقوم بذلك في الفلاتر قبل الإرسال؟

### 6. التقسيم والترقيم (Pagination)
*   **الآلية:** هل نستخدم `page & per_page` (Offset) أم `cursor` based؟
*   **الاستجابة:** كيف أعرف أنني وصلت لنهاية القائمة؟ (هل هناك حقل `total_pages` أم `has_next`؟).

### 7. التعامل مع الأخطاء (Error Handling)
*   **رموز الحالة (Status Codes):** أحتاج لقائمة بجميع الأكواد المتوقعة.
    *   `401`: انتهت الجلسة (أقوم بتسجيل الخروج تلقائيا).
    *   `403`: ممنوع الوصول.
    *   `422`: خطأ في التحقق من البيانات (Validation Error).
    *   `500`: خطأ في السيرفر.
*   **رسائل الخطأ:** هل رسائل الخطأ موحدة أم آتية من قاعدة البيانات مباشرة؟ (يجب أن تكون جاهزة للعرض للمستخدم العربي).

### 8. الإشعارات (Push Notifications)
*   **الهيكلة:** ما هو شكل الـ `payload` القادم من الإشعار؟
*   **التنقل:** هل يحتوي الـ payload على `type` و `id` للتنقل داخل التطبيق عند الضغط على الإشعار؟ (مثلاً: إشعار "طلب جديد" يجب أن ينقلني لشاشة تفاصيل الطلب).

### 9. بيئة العمل والاختبار (Environments)
*   **عناوين URL:** روابط بيئة التطوير (Dev)، التجريبية (Staging)، والإنتاج (Production).
*   **اختبار الـ API:** هل يوجد بيئة Sandbox للاختبار (خاصة للدفع الإلكتروني)؟

### 10. متطلبات خاصة بالأداء (Performance)
*   **Throttling/Rate Limiting:** هل هناك حدود لعدد الطلبات في الدقيقة؟ (لأضع آلية Retry ذكية).
*   **التخزين المؤقت (Caching):** هل الباكند يدعم الـ ETag أو Last-Modified Headers؟ (لتفعيل التخزين المؤقت الذكي وتقليل استهلاك البيانات).

---

**نصيحة إضافية من خبرتي:**
أطلب دائماً من مطور الباكند توفير **Postman Environment** جاهزة، وأقوم بتشغيل الـ Collection للتأكد من أن جميع الـ Endpoints تعمل قبل كتابة سطر واحد من الكود في فلاتر. هذا يوفر ساعات من التصحيح (Debugging).
