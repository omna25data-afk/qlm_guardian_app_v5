---
title: المدخلات والأحداث "Input and events" (شرح الملف)
description: كيف يتم التعامل مع المدخلات والأحداث في تطبيقات GenUI.
---

يُفصّل الملف الإجراء الذي يتم من خلاله تمرير تفاعل المستخدم من داخل الواجهة البصرية (`Widget`) التي نشأت عبر الذكاء الاصطناعي وإخبار الوكيل (AI Agent) بهذا الإجراء.

## نظرة عامة (Overview)

هذه البنية قائمة لتمكين نموذج الـ AI من مراقبة ما إذا كان المستخدم يتفاعل فعلياً مع واجهة الفلتر (كأن يضغط على زر). تسير دورة هذه العمليات بالشكل التالي:

1. التفاعل السطحي (Interaction): المستخدم يضغط على الزر المنشأ من قبل النموذج.
2. الاحتجاز (Capture): المكون البصري في Flutter يلقي بحدث `UiEvent`.
3. التجهيز (Processing): إطار العمل (Framework) يعزل نوع الحدث ويربطه بتعريف واجهة العرض (مثل إضافة مُعرِّف المساحة `surfaceId`).
4. الإرسال (Transmission): يتم إرسال هذا الإطار للوكيل (AI) من خلال الـ `ContentGenerator` عبر حقول الرد.

## تعريف الأحداث (Defining events)

* **على مستوى البروتوكول:** يستخدم بروتوكول اتصال A2UI رسالة تسمى `userAction`، تضم اسم الحدث ومُعرف المكون البصري وسجل الوقت (Timestamp) مع المراجع والبيانات المرافقة (`context`).
* **التجهيز في لغة Dart:** يُمثل هذا بوضوح في حزمة `genui` عبر `UiEvent` وفئتها الممتدة `UserActionEvent`.

## رصد الأحداث في المكونات (Capturing events in widgets)

عند إنشاء المكون العائد للفهرس (عبر `widgetBuilder` ضمن الـ CatalogItem)، تُستخرج قيم الحدث ومرجع النقر ليتم استخدام `itemContext.dispatchEvent(...)` والتي تسمح بإرسال إجراء (Action) مثل الضغط للمحرك الأساسي.

## خط أنابيب الأحداث (Event processing pipeline)

1. **برمجة السطح (GenUiSurface):** تلتقط الحدث المتولد وتضيف إليه المُعرّف `surfaceId` ليفهم الذكاء الاصطناعي موضع النقر بدقة، وتوجهه إلى المضيف.
2. **معالج الرسائل (A2uiMessageProcessor):** يقوم بتحويل هذا البلوك إلى غلاف JSON مطابق لبروتوكول الـ API الخاص ببيانات الأفعال (`userAction`) ويطلقه بسلسلة أحداث تحت اسم `UserUiInteractionMessage`.
3. **التوصيل والنهائية (Transmission to AI):** فئة `GenUiConversation` تتصنت بامتياز على تدفق أوامر الـ `onSubmit` وتقوم فورا بضخها كإعلان رسمي وتمررها عبر دوال `ContentGenerator` مثل `sendRequest` للنموذج للاستجابة لها بشكل مباشر لاستكمال الدورة التفاعلية من جديد.
