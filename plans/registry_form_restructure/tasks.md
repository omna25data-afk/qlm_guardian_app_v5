# قائمة المهام للتنفيذ (Tasks List)

هذه القائمة مبنية تفصيلياً على وثيقة التصميم `design.md`، ومخصصة لبرمجة وتعديل واجهات المستخدم (Flutter).

> **تعليمات وكيل الـ AI:** استخدم هذه القائمة لتتبع حالة العمل وضع علامة `[x]` فور الانتهاء من المهمة. لا تنتقل للمهمة التالية ما لم تتأكد من سلامة الكود في المهمة الحالية.

## المرحلة الأولى: بنية البيانات والـ Providers

- [x] 1. فحص وتعديل `AddRegistryEntryState` في `add_registry_entry_provider.dart` لضمان وجود حقول:
  - تاريخ المحرر (هجري/ميلادي).
  - تاريخ القيد للأمين (هجري/ميلادي).
  - رسوم التوثيق وتوزيعاتها (الضريبة، الزكاة، مبلغ الضريبة، مبلغ الزكاة، أرقام السنادات).
  - حالة الإعفاء (isExempted) وسبب الإعفاء.
- [x] 2. إضافة منطق حسابي "Calculate Fees" داخل المزوّد أو الشاشة يعمل عند `onChange` لحساب إجمالي الرسوم بناءً على الخيارات المحددة، إن لزم.

## المرحلة الثانية: إعادة هيكلة واجهة الكاتب والأمين (PartiesSection و GuardianSection)

- [x] 3. في `parties_section.dart`: دمج وتنسيق عرض "نوع العقد" و "حقول الكاتب".
- [x] 4. في `parties_section.dart`: إضافة حقول اختيار "تاريخ المحرر" (بدعم هجري/ميلادي).
- [x] 5. في `guardian_section.dart`: ربط وإضافة حقول التواريخ "تاريخ القيد"، والتأكد من أخذها القيمة الافتراضية من "تاريخ المحرر".
- [x] 6. تعديل دالة `itemLabelBuilder` للقائمة المنسدلة في `guardian_section.dart` لتطابق النص المطلوب: `نوع السجل + رقمه + السنة + اسم الأمين`.

## المرحلة الثالثة: إعادة هيكلة واجهة التوثيق والمالية (DocumentationSection)

- [x] 7. في `documentation_section.dart`: تغيير `itemLabelBuilder` لسجل التوثيق ليصبح: `فئة ونوع السجل + رقم السجل + سنة الاستخدام`.
- [x] 8. إنشاء/تحديث جزء "البيانات المالية للضريبة والزكاة": حقول (مبلغ الضريبة، سند الضريبة، مبلغ الزكاة، سند الزكاة).
- [x] 9. بناء جزء "الرسوم وتوزيعاتها":
  - [x] بناء زر/مفتاح التبديل للإعفاء `is_exempted` مع حقل `exemption_reason`.
  - [x] ربط زر الإعفاء لإخفاء أو تصفير حقول الرسوم والطبقات الأخرى.
  - [x] تطبيق عنصر `ExpansionTile` لملخص الرسوم (الإجمالي الكلي).
  - [x] تطبيق عنصر `ExpansionTile` لتفاصيل التوزيع وعرضها بوضعية `readOnly: true`.

## المرحلة الرابعة: التركيب النهائي والاختبار (Assembly & Validation)

- [x] 10. تجميع الأقسام الثلاثة في `compact_registry_entry_screen.dart` بشكل مرتب وتسلسلي.
- [x] 11. إضافة كود البانر/تنبيه قبل القسم المالي إذا كان القيد مقيداً في سجل الأمين.
- [x] 12. تجربة التطبيق (Flutter Chrome) والتحقق من سلاسة الاستخدام.
- [x] 13. التأكد من معالجة حزمة البيانات النهائية وبناؤها لإرسالها بالشكل الصحيح في `submitEntry`.
