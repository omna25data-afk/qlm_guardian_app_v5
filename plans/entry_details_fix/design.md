# ูุซููุฉ ุงูุชุตููู ุงููุนูุงุฑู (Design Document)

## ๐ ูุธุฑุฉ ุนุงูุฉ (Overview)

ูุญู ูุดููุฉ ุนุฏู ุธููุฑ ุงูุจูุงูุงุช ุงููุงููุฉ ูุชุงุฑูุฎ ุงูููุฏ ูู ุณุฌู ุงูุฃููู ุจุดูู ูุงููุ ุณูุชุฑูุฒ ุงูุนูู ุงูุฑุฆูุณู ุนูู **ุทุจูุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API Layer)** ูู ุงูู Backend (Laravel). ุชุญุฏูุฏุงูุ ุณูููู ุจุชุนุฏูู ุงูููุฏููู ุงููุณุคูู ุนู ุชุญููู ุจูุงูุงุช ุงูููุฏูู `RegistryEntry` ุฅูู JSONุ ููู `RegistryEntryResource`.

ูู ุฌูุฉ ุชุทุจูู ููุงุชุฑ (Frontend)ุ ูุนุชูุฏ ุงูููุฏูู `RegistryEntrySections` ุจุงููุนู ุนูู ูุฑุงุกุฉ ูุฐู ุงูุจูุงูุงุช (ูุซู `support_amount` ู `sustainability_amount` ูุบูุฑูุง) ูู ุงูุฑุฏ ุงููุงูู (fees) ููุณู ุณุฌู ุงูุฃููู (record_book). ูุฐููุ ุจูุฌุฑุฏ ุชูููุฑ ูุฐู ุงูุจูุงูุงุช ูู ุงูุจุงููุฏุ ุณุชุธูุฑ ุชููุงุฆูุงู ูู ุงูุดุงุดุฉ ุจุฏูู ุญุงุฌุฉ ูุชุนุฏููุงุช ูุนูุฏุฉ ูู ููุงุชุฑุ ูุง ูู ุชูู ููุงู ูุดููุฉ ูู `contract_details`.

## ๐ ุงูุชุนุฏููุงุช ุงูููุชุฑุญุฉ (Proposed Changes)

### 1. ุทุจูุฉ ููุงุนุฏ ุงูุจูุงูุงุช ูุงูููุงุฐุฌ (Database & Models)

- **ูุง ููุฌุฏ ุชุนุฏููุงุช ุถุฑูุฑูุฉ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.**
- ุงูุญููู ุงููุงููุฉ (ูุซู `sustainability_amount`, `support_amount`, `authentication_fee_amount`ุ ุฅูุฎ) ูุญูู `guardian_hijri_date` ููุนูููุงุช ุงูุฅุนูุงุก (`exemption_type`) ููุฌูุฏุฉ ุจุงููุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุฏูู `RegistryEntry`.

## ๐ป ุงูุชุบููุฑุงุช ุงูุชูููุฉ ุงูููุชุฑุญุฉ (Proposed Changes)

ุงูุชุฑููุฒ ุงูุฃูุจุฑ ุณูููู ุนูู ุงูุจุงููุฏ (Laravel)ุ ุญูุซ ุณูุชู ุชุนุฏูู ุงูู Resource ุงููุณุคูู ุนู ุฅุฑุฌุงุน ุจูุงูุงุช ุงูููุฏ.

### ุงูุจุงููุฏ (Backend - Custom Filment)

**ุงูููู ุงููุณุชูุฏู:** `app/Http/Resources/RegistryEntryResource.php` (ูุฃูุถุงู ููู `app/Http/Resources/Standardized/RegistryEntryResource.php`).

**ุงูุชุนุฏููุงุช ุงููุทููุจุฉ:**

1. **ุงููุจุงูุบ ุงููุงููุฉ (`fees`):** ุชุนุฏูู ูุตูููุฉ ุงูุฑุณูู ูุฅุฑุฌุงุน ุฌููุน ุงูุฑุณูู ุงููุณุฌูุฉ: `amount`ุ `penalty`ุ `support`ุ `sustainability`ุ `authentication_fee`ุ `transfer_fee`ุ `other_fee` ูู ุงููุฎุฑุฌ `total`.
2. **ูุนูููุงุช ุงูุฅุนูุงุก:** ุฅุฑุฌุงุน `exemption_type` ู `exemption_reason` ุถูู ุงูู JSON ุงูุฃุณุงุณู.
3. **ุจูุงูุงุช ุณุฌู ุงูุฃููู (`record_book`):** ุฅุถุงูุฉ `guardian_hijri_date` ุฏุงุฎู ูุงุฆู ุจูุงูุงุช ุงูุณุฌู.
4. **ุชุญุฏูุซ ุงูุฌูุจ ุงูุดุงูู ูููุชุงุจุฉ (22 ูุจุฑุงูุฑ):** ููุชุฃูุฏ ูู ุชูุงุฌุฏ ุฌููุน ุงูุญููู ุงูุชู ุทูุจูุง ุงููุณุชุฎุฏูุ ุจุฏูุงู ูู ุณุฑุฏ ุญูู ุชูู ุงูุขุฎุฑ ุจุดูู ูุฏูู ูุฌุฏูู `registry_entries` ูุงูุฌุฏุงูู ุงููุฎุตุตุฉ (ูุซู `sale_contracts`)ุ ุณูุชู ุชุญููู ูุงุฆู ุงููููุฐุฌ ุฅูู ูุตูููุฉ (Array) ุนุจุฑ `$this->resource->toArray()` ุซู ุฏูุฌ ุงูุญููู ุงูููุณูุฉ (Formatted Fields ูู Financials ู Dates ูุงูุนูุงูุงุช) ูุนูุง. ูุฐุง ูุถูู ุฃู ุฌููุน ุงูุฃุนูุฏุฉ ูู ุฌุฏูู `registry_entries` ููุฌูุฏุฉ ุงูุชุฑุงุถูุงูุ ูุณูุชู ุฅุถุงูุฉ ุฏูุฌ ูุงูู ุญููู ุงูุฌุฏูู ุงููุฎุตุต (Sub-table) ุฏุงุฎู ุญูู `contract_details` ูุถูุงู ุนุฏู ููุฏุงู ุฃู ุนููุฏ ูู ุฌุฏุงูู ุงูุชุตุฑูุงุชุ ุงููุจูุนุงุชุ ุฅูุฎ.ุ ูุบูุฑูุง) ุจุฏูุงู ูู ุฌูุน ุงูุฑุณูู ุงูุฃุณุงุณูุฉ ูุงูุบุฑุงูุฉ ููุท.
    3. **ุชูุณูุน ูุตูููุฉ `record_book` (ูุณู ุงูุฃููู):** ุฅุถุงูุฉ ููุชุงุญ `guardian_hijri_date` ุจูุงุกู ุนูู ุงูุญูู `$this->guardian_hijri_date`.
    4. **ุฅุถุงูุฉ ุญููู ุงูุฅุนูุงุก ุงูุฃุณุงุณูุฉ:** ุฅุถุงูุฉ ููุงุชูุญ ูู `exemption_type` ู `exemption_reason`.
    5. **ุงูุชุฃูุฏ ูู ุฅุฑุณุงู ุงูุจูุงูุงุช ุงูุฏููุงููููุฉ ููุนูุฏ ุจุดูู ุตุญูุญ:** ูุฑุงุฌุนุฉ ุฅุฑุณุงู `contract_details` ุจุถูุงู ุชุทุงุจูู ุงูุชุงู ูุน ูุง ูุชููุนู ุชุทุจูู ููุงุชุฑ ูู `formData`.

### 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู (UI / Frontend - Flutter)

- **ูููุงุช ุณูุชู ุงุฎุชุจุงุฑ ุนูููุง ููุชุญูู (ุจุฏูู ุชุนุฏูู ุฌููุฑู ูุชููุน):**
  - `f:\herd\qlm_guardian_app_v5\lib\features\system\data\models\registry_entry_sections.dart`
    - ูุชู ูุญุต ุฏุงูุฉ `fromJson` ููุชุฃูุฏ ูู ูุฏุฑุชูุง ุนูู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูุฏููุงููููุฉ ูู `json['contract_details']` ุจููุงุกุฉ.
  - `f:\herd\qlm_guardian_app_v5\lib\features\registry\presentation\screens\entry_details_screen.dart`
    - ุงูุดุงุดุฉ ูุฌูุฒุฉ ููุจุฑูุฌุฉ ูุทุจุงุนุฉ ูุฐู ุงููุชุบูุฑุงุช. ููุท ุฅุฌุฑุงุก ุงูุชุณุช (Test) ุงูููุงุฆู.

## ๐ ูุณุงุฑ ุงูุจูุงูุงุช (Data Flow)

1. ูููู ุงููุณุชุฎุฏู (ูู ููุงุชุฑ) ุงูุฏุฎูู ูุตูุญุฉ "ุชูุงุตูู ุงูููุฏ" ุฃู ุนุฑุถ ุงููุงุฆูุฉ.
2. ูุชู ุฅุฑุณุงู ุทูุจ `GET /api/registry-entries/{id}` ุฃู ูููุงุฆูุฉ ูุงููุฉ.
3. ูููู Laravel ุจุฌูุจ `RegistryEntry` ูุน ุนูุงูุงุชู ูุชูุฑูุฑู ุฅูู `RegistryEntryResource`.
4. ูููู ุงูู Resource ุจุจูุงุก ูููู ุงูู JSON ูุชุถููู ุฌููุน ุงูุฑุณูู ุงููุญุฏุซุฉ ูุชุงุฑูุฎ ุงูููุฏ ุงููุฌุฑู ูุญุฏุซ ุงูุฅุนูุงุกุ ุจุงูุฅุถุงูุฉ ููุญููู ุงููุชุบูุฑุฉ ูู `contract_details`.
5. ูุณุชูุจู ููุงุชุฑ ูุฐุง ุงูู JSON ููููู `RegistryEntrySections.fromJson` ุจุชุญูููู ุจุดูู ูุงูู.
6. ูููู `EntryDetailsScreen` ุจุนุฑุถ ุฌููุน ุงูููู ุงููุณุชุญุฏุซุฉ ุจุดูู ุณููู ูููุณุชุฎุฏู ุงูููุงุฆู.
